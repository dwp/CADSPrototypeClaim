!function($){function processError(e,r){r=r.replace(/%%C%%/gi,",");var a=!0;switch(options.displayType){case"alert-one":alert(r),styleField(e,!0),a=!1;break;case"alert-all":case"display-html":returnHash.push([e,r])}return a}function displayHTMLErrors(e,r){for(var a=options.errorTextIntro+"<br /><br />",l=0;l<r.length;l++)a+=options.errorHTMLItemBullet+r[l][1]+"<br />",styleField(r[l][0],0==l);return r.length>0?($("#"+options.errorTargetElementId).css("display","block"),$("#"+options.errorTargetElementId).html(a),!1):!0}function styleField(e,r){if(void 0==e.type){r&&e[0].focus();for(var a=0;a<e.length;a++)$(e[a]).hasClass(options.errorFieldClass)||$(e[a]).addClass(options.errorFieldClass)}else options.errorFieldClass&&$(e).addClass(options.errorFieldClass),r&&e.focus()}function isValidEmail(e){var r=$.trim(e),a="@",l=".",o=r.indexOf(a),s=r.length;return-1==r.indexOf(a)||-1==r.indexOf(a)||0==r.indexOf(a)||r.indexOf(a)==s||-1==r.indexOf(l)||0==r.indexOf(l)||r.indexOf(l)==s||-1!=r.indexOf(a,o+1)||r.substring(o-1,o)==l||r.substring(o+1,o+2)==l||-1==r.indexOf(l,o+2)||-1!=r.indexOf(" ")?!1:!0}function isValidDate(e,r,a,l){var o;if(o=a%4!=0||a%100==0&&a%400!=0?[31,28,31,30,31,30,31,31,30,31,30,31]:[31,29,31,30,31,30,31,31,30,31,30,31],!e||!r||!a)return!1;if(1>e||e>12)return!1;if(0>a)return!1;if(1>r||r>o[e-1])return!1;if(l){var s=new Date,t=s.getMonth()+1,i=s.getDate(),n=s.getFullYear();1==String(t).length&&(t="0"+t),1==String(i).length&&(i="0"+i);var f=String(n)+String(t)+String(i);if(1==String(e).length&&(e="0"+e),1==String(r).length&&(r="0"+r),incomingDate=String(a)+String(e)+String(r),Number(f)>Number(incomingDate))return!1}return!0}var options={},returnHash=[];$.fn.RSV=function(e){return options=$.extend({},$.fn.RSV.defaults,e),this.each(function(){$(this).bind("submit",{currForm:this,options:options},$(this).RSV.validate)})},$.fn.RSV.defaults={rules:[],displayType:"alert-all",errorFieldClass:null,errorTextIntro:"Please fix the following error(s):",errorJSItemBullet:"* ",errorHTMLItemBullet:"&bull; ",errorTargetElementId:"validation",customErrorHandler:null,onCompleteHandler:null},$.fn.RSV.validate=function(event){options=event.data.options;var form=event.data.currForm,rules=options.rules;returnHash=[],"display-html"==options.displayType&&($("#"+options.errorTargetElementId).text("").hide(),null!=options.errorFieldClass&&$("."+options.errorFieldClass).removeClass(options.errorFieldClass));for(var i=0;i<rules.length;i++){var row=rules[i].replace(/\\,/gi,"%%C%%");row=row.split(",");for(var satisfiesIfConditions=!0;row[0].match("^if:");){var cond=row[0];cond=cond.replace("if:","");var comparison="equal",parts=[];-1!=cond.search("!=")?(parts=cond.split("!="),comparison="not_equal"):parts=cond.split("=");var fieldToCheck=parts[0],valueToCheck=parts[1],fieldnameValue="";if(void 0==form[fieldToCheck].type)for(var j=0;j<form[fieldToCheck].length;j++)form[fieldToCheck][j].checked&&(fieldnameValue=form[fieldToCheck][j].value);else"checkbox"==form[fieldToCheck].type?form[fieldToCheck].checked&&(fieldnameValue=form[parts[0]].value):fieldnameValue=form[parts[0]].value;if("equal"==comparison&&fieldnameValue!=valueToCheck){satisfiesIfConditions=!1;break}if("not_equal"==comparison&&fieldnameValue==valueToCheck){satisfiesIfConditions=!1;break}row.shift()}if(satisfiesIfConditions){var requirement=row[0],fieldName=$.trim(row[1]),fieldName2,fieldName3,errorMessage,lengthRequirements,date_flag;if("function"!=requirement&&void 0==form[fieldName])return alert('RSV Error: the field "'+fieldName+"\" doesn't exist! Please check your form and settings."),!1;if("function"!=requirement&&options.errorFieldClass)if(void 0==form[fieldName].type)for(var j=0;j<form[fieldName].length;j++)$(form[fieldName][j]).hasClass(options.errorFieldClass)&&$(form[fieldName][j]).removeClass(options.errorFieldClass);else $(form[fieldName]).hasClass(options.errorFieldClass)&&$(form[fieldName]).removeClass(options.errorFieldClass);switch(6==row.length?(fieldName2=row[2],fieldName3=row[3],date_flag=row[4],errorMessage=row[5]):5==row.length?(fieldName2=row[2],fieldName3=row[3],errorMessage=row[4]):4==row.length?(fieldName2=row[2],errorMessage=row[3]):errorMessage=row[2],requirement.match("^length")&&(lengthRequirements=requirement,requirement="length"),requirement.match("^range")&&(rangeRequirements=requirement,requirement="range"),requirement){case"required":if(void 0==form[fieldName].type){for(var oneIsChecked=!1,j=0;j<form[fieldName].length;j++)form[fieldName][j].checked&&(oneIsChecked=!0);if(!oneIsChecked&&!processError(form[fieldName],errorMessage))return!1}else if("select-multiple"==form[fieldName].type){for(var oneIsSelected=!1,k=0;k<form[fieldName].length;k++)form[fieldName][k].selected&&(oneIsSelected=!0);if(!(oneIsSelected&&0!=form[fieldName].length||processError(form[fieldName],errorMessage)))return!1}else if("checkbox"==form[fieldName].type){if(!form[fieldName].checked&&!processError(form[fieldName],errorMessage))return!1}else if(!form[fieldName].value&&!processError(form[fieldName],errorMessage))return!1;break;case"digits_only":if(form[fieldName].value&&form[fieldName].value.match(/\D/)&&!processError(form[fieldName],errorMessage))return!1;break;case"letters_only":if(form[fieldName].value&&form[fieldName].value.match(/[^a-zA-Z]/)&&!processError(form[fieldName],errorMessage))return!1;break;case"is_alpha":if(form[fieldName].value&&form[fieldName].value.match(/\W/)&&!processError(form[fieldName],errorMessage))return!1;break;case"custom_alpha":for(var conversion={L:"[A-Z]",V:"[AEIOU]",l:"[a-z]",v:"[aeiou]",D:"[a-zA-Z]",F:"[aeiouAEIOU]",C:"[BCDFGHJKLMNPQRSTVWXYZ]",x:"[0-9]",c:"[bcdfghjklmnpqrstvwxyz]",X:"[1-9]",E:"[bcdfghjklmnpqrstvwxyzBCDFGHJKLMNPQRSTVWXYZ]"},reg_exp_str="",j=0;j<fieldName2.length;j++)reg_exp_str+=conversion[fieldName2.charAt(j)]?conversion[fieldName2.charAt(j)]:fieldName2.charAt(j);var reg_exp=new RegExp(reg_exp_str);if(form[fieldName].value&&null==reg_exp.exec(form[fieldName].value)&&!processError(form[fieldName],errorMessage))return!1;break;case"reg_exp":var reg_exp_str=fieldName2.replace(/%%C%%/gi,",");if(5==row.length)var reg_exp=new RegExp(reg_exp_str,fieldName3);else var reg_exp=new RegExp(reg_exp_str);if(form[fieldName].value&&null==reg_exp.exec(form[fieldName].value)&&!processError(form[fieldName],errorMessage))return!1;break;case"length":switch(comparison_rule="",rule_string="",lengthRequirements.match(/length=/)?(comparison_rule="equal",rule_string=lengthRequirements.replace("length=","")):lengthRequirements.match(/length>=/)?(comparison_rule="greater_than_or_equal",rule_string=lengthRequirements.replace("length>=","")):lengthRequirements.match(/length>/)?(comparison_rule="greater_than",rule_string=lengthRequirements.replace("length>","")):lengthRequirements.match(/length<=/)?(comparison_rule="less_than_or_equal",rule_string=lengthRequirements.replace("length<=","")):lengthRequirements.match(/length</)&&(comparison_rule="less_than",rule_string=lengthRequirements.replace("length<","")),comparison_rule){case"greater_than_or_equal":if(!(form[fieldName].value.length>=parseInt(rule_string)||processError(form[fieldName],errorMessage)))return!1;break;case"greater_than":if(!(form[fieldName].value.length>parseInt(rule_string)||processError(form[fieldName],errorMessage)))return!1;break;case"less_than_or_equal":if(!(form[fieldName].value.length<=parseInt(rule_string)||processError(form[fieldName],errorMessage)))return!1;break;case"less_than":if(!(form[fieldName].value.length<parseInt(rule_string)||processError(form[fieldName],errorMessage)))return!1;break;case"equal":var range_or_exact_number=rule_string.match(/[^_]+/),fieldCount=range_or_exact_number[0].split("-");if(2==fieldCount.length){if((form[fieldName].value.length<fieldCount[0]||form[fieldName].value.length>fieldCount[1])&&!processError(form[fieldName],errorMessage))return!1}else if(form[fieldName].value.length!=fieldCount[0]&&!processError(form[fieldName],errorMessage))return!1}break;case"valid_email":if(form[fieldName].value&&!isValidEmail(form[fieldName].value)&&!processError(form[fieldName],errorMessage))return!1;break;case"valid_date":var isLaterDate=!1;if("later_date"==date_flag?isLaterDate=!0:"any_date"==date_flag&&(isLaterDate=!1),!isValidDate(form[fieldName].value,form[fieldName2].value,form[fieldName3].value,isLaterDate)&&!processError(form[fieldName],errorMessage))return!1;break;case"same_as":if(form[fieldName].value!=form[fieldName2].value&&!processError(form[fieldName],errorMessage))return!1;break;case"range":switch(comparison_rule="",rule_string="",rangeRequirements.match(/range=/)?(comparison_rule="equal",rule_string=rangeRequirements.replace("range=","")):rangeRequirements.match(/range>=/)?(comparison_rule="greater_than_or_equal",rule_string=rangeRequirements.replace("range>=","")):rangeRequirements.match(/range>/)?(comparison_rule="greater_than",rule_string=rangeRequirements.replace("range>","")):rangeRequirements.match(/range<=/)?(comparison_rule="less_than_or_equal",rule_string=rangeRequirements.replace("range<=","")):rangeRequirements.match(/range</)&&(comparison_rule="less_than",rule_string=rangeRequirements.replace("range<","")),comparison_rule){case"greater_than_or_equal":if(!(form[fieldName].value>=Number(rule_string)||processError(form[fieldName],errorMessage)))return!1;break;case"greater_than":if(!(form[fieldName].value>Number(rule_string)||processError(form[fieldName],errorMessage)))return!1;break;case"less_than_or_equal":if(!(form[fieldName].value<=Number(rule_string)||processError(form[fieldName],errorMessage)))return!1;break;case"less_than":if(!(form[fieldName].value<Number(rule_string)||processError(form[fieldName],errorMessage)))return!1;break;case"equal":var rangeValues=rule_string.split("-");if((form[fieldName].value<Number(rangeValues[0])||form[fieldName].value>Number(rangeValues[1]))&&!processError(form[fieldName],errorMessage))return!1}break;case"function":if(custom_function=fieldName,eval("var result = "+custom_function+"()"),-1!=result.constructor.toString().indexOf("Array"))for(var j=0;j<result.length;j++)if(!processError(result[j][0],result[j][1]))return!1;break;default:return alert("Unknown requirement flag in validateFields(): "+requirement),!1}}}if("function"==typeof options.customErrorHandler){if(!options.customErrorHandler(form,returnHash))return!1}else if("alert-all"==options.displayType){for(var errorStr=options.errorTextIntro+"\n\n",i=0;i<returnHash.length;i++)errorStr+=options.errorJSItemBullet+returnHash[i][1]+"\n",styleField(returnHash[i][0],0==i);if(returnHash.length>0)return alert(errorStr),!1}else if("display-html"==options.displayType){var success=displayHTMLErrors(form,returnHash);if(!success)return!1}return"function"==typeof options.onCompleteHandler?options.onCompleteHandler():!0}}(jQuery);